<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sayz | Minimalist Görsel Boyutlandırma</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JSZip Kütüphanesi (ZIP oluşturmak için) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#000000',
                        secondary: '#ffffff',
                        accent: '#333333',
                        light: '#f4f4f5',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #000000;
        }

        /* Özel Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #888; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }

        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23333' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        
        .drop-zone.active {
            background-color: #f9fafb;
            transform: scale(0.99);
            border-color: #000;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        /* macOS stil maskeleme için yardımcı sınıf */
        .macos-squircle {
            border-radius: 22.37%; /* Apple'ın ikonik squircle formuna en yakın CSS değeri */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="border-b border-gray-200 py-4 sticky top-0 bg-white/90 backdrop-blur-sm z-50">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-crop-simple text-2xl"></i>
                <h1 class="text-xl font-semibold tracking-tight">Sayz</h1>
            </div>
            <a href="#" class="text-sm font-medium hover:text-gray-600 transition-colors">
                <i class="fa-brands fa-github text-lg"></i>
            </a>
        </div>
    </nav>

    <!-- Ana İçerik -->
    <main class="flex-grow container mx-auto px-6 py-10">
        
        <!-- Yükleme Alanı -->
        <div class="max-w-4xl mx-auto mb-16">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-light mb-2">Görsellerinizi Platformlara Hazırlayın</h2>
                <p class="text-gray-500">iOS, Android, macOS ve Sosyal Medya için tek tıkla otomatik boyutlandırma.</p>
            </div>

            <div id="dropZone" class="drop-zone w-full h-64 rounded-2xl flex flex-col justify-center items-center cursor-pointer hover:bg-gray-50 relative">
                <input type="file" id="fileInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/png, image/jpeg, image/jpg, image/webp">
                <div class="text-center pointer-events-none transition-all duration-300" id="dropContent">
                    <div class="mb-4">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-800"></i>
                    </div>
                    <p class="text-lg font-medium text-gray-800">Görseli buraya sürükleyin</p>
                    <p class="text-sm text-gray-400 mt-2">veya seçmek için tıklayın</p>
                    <p class="text-xs text-gray-300 mt-4">JPG, PNG, WEBP (Maks. 20MB)</p>
                </div>
                
                <!-- Önizleme -->
                <div id="previewContainer" class="hidden absolute inset-0 w-full h-full bg-white rounded-2xl flex items-center justify-center p-4">
                    <img id="sourceImage" class="max-h-full max-w-full object-contain rounded shadow-sm" alt="Source">
                    <button id="removeImageBtn" class="absolute top-4 right-4 bg-white border border-gray-200 p-2 rounded-full hover:bg-gray-100 shadow-sm transition-all z-10">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Kontroller ve Çıktılar -->
        <div id="outputSection" class="hidden transition-opacity duration-500">
            
            <!-- Filtreler ve Aksiyon -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-gray-100 pb-4 gap-4">
                <div class="flex gap-2 overflow-x-auto pb-2 md:pb-0 w-full md:w-auto" id="filterButtons">
                    <button class="filter-btn active px-4 py-2 text-sm font-medium bg-black text-white rounded-lg transition-colors" data-filter="all">Tümü</button>
                    <button class="filter-btn px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" data-filter="ios">
                        <i class="fa-brands fa-apple mr-1"></i> iOS
                    </button>
                    <button class="filter-btn px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" data-filter="macos">
                        <i class="fa-solid fa-laptop mr-1"></i> macOS
                    </button>
                    <button class="filter-btn px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" data-filter="android">
                        <i class="fa-brands fa-google-play mr-1"></i> Android
                    </button>
                    <button class="filter-btn px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" data-filter="social">
                        <i class="fa-solid fa-share-nodes mr-1"></i> Sosyal
                    </button>
                </div>

                <button id="downloadAllBtn" class="bg-black text-white px-6 py-2.5 rounded-lg hover:bg-gray-800 transition-colors flex items-center gap-2 shadow-lg hover:shadow-xl w-full md:w-auto justify-center">
                    <span id="downloadText">Hepsini İndir (ZIP)</span>
                    <i class="fa-solid fa-file-zipper"></i>
                    <div id="downloadSpinner" class="loader hidden border-white border-t-transparent"></div>
                </button>
            </div>

            <!-- Grid -->
            <div id="gridContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Javascript ile kartlar buraya eklenecek -->
            </div>
        </div>

    </main>

    <footer class="border-t border-gray-200 py-8 mt-10">
        <div class="container mx-auto px-6 text-center text-sm text-gray-400 flex flex-col items-center gap-2">
            <p>&copy; 2025 Sayz. Tüm hakları saklıdır.</p>
            <div class="flex gap-4 mt-2">
                <i class="fa-brands fa-instagram hover:text-black cursor-pointer transition-colors"></i>
                <i class="fa-brands fa-twitter hover:text-black cursor-pointer transition-colors"></i>
                <i class="fa-brands fa-linkedin hover:text-black cursor-pointer transition-colors"></i>
            </div>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- Yapılandırma ---
        // Platform boyut tanımları
        const presets = [
            // iOS (App Store)
            { id: 'ios_icon', name: 'App Icon', group: 'ios', w: 1024, h: 1024, icon: 'fa-apple' },
            { id: 'ios_iphone_65', name: 'iPhone 6.5" Display', group: 'ios', w: 1242, h: 2688, icon: 'fa-mobile-screen' },
            { id: 'ios_iphone_55', name: 'iPhone 5.5" Display', group: 'ios', w: 1242, h: 2208, icon: 'fa-mobile-screen' },
            { id: 'ios_ipad_pro', name: 'iPad Pro 12.9"', group: 'ios', w: 2048, h: 2732, icon: 'fa-tablet-screen-button' },
            
            // macOS (Güncel Squircle Formu)
            { id: 'macos_icon_1024', name: 'macOS App Icon (L)', group: 'macos', w: 1024, h: 1024, icon: 'fa-laptop' },
            { id: 'macos_icon_512', name: 'macOS App Icon (M)', group: 'macos', w: 512, h: 512, icon: 'fa-laptop' },
            { id: 'macos_icon_256', name: 'macOS App Icon (S)', group: 'macos', w: 256, h: 256, icon: 'fa-laptop' },

            // Android (Google Play)
            { id: 'android_icon', name: 'Play Store Icon', group: 'android', w: 512, h: 512, icon: 'fa-google-play' },
            { id: 'android_feature', name: 'Feature Graphic', group: 'android', w: 1024, h: 500, icon: 'fa-image' },
            { id: 'android_phone', name: 'Phone Screenshot', group: 'android', w: 1080, h: 1920, icon: 'fa-mobile-android' },
            { id: 'android_tablet', name: 'Tablet 10"', group: 'android', w: 1920, h: 1200, icon: 'fa-tablet-android' },

            // Social Media
            { id: 'social_insta_sq', name: 'Instagram Kare', group: 'social', w: 1080, h: 1080, icon: 'fa-instagram' },
            { id: 'social_insta_story', name: 'Instagram Story', group: 'social', w: 1080, h: 1920, icon: 'fa-instagram' },
            { id: 'social_yt_thumb', name: 'YouTube Thumbnail', group: 'social', w: 1280, h: 720, icon: 'fa-youtube' }, 
            { id: 'social_twitter_header', name: 'Twitter Header', group: 'social', w: 1500, h: 500, icon: 'fa-twitter' },
            { id: 'generic_16_9', name: 'Genel 16:9', group: 'social', w: 1920, h: 1080, icon: 'fa-display' }
        ];

        // --- DOM Elemanları ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const dropContent = document.getElementById('dropContent');
        const previewContainer = document.getElementById('previewContainer');
        const sourceImage = document.getElementById('sourceImage');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const outputSection = document.getElementById('outputSection');
        const gridContainer = document.getElementById('gridContainer');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const downloadAllBtn = document.getElementById('downloadAllBtn');

        let originalImgObject = null;
        let generatedBlobs = {}; // İndirme için blob'ları saklayacağız

        // --- Event Listeners ---

        // Drag & Drop Efektleri
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.classList.add('active');
        }

        function unhighlight(e) {
            dropZone.classList.remove('active');
        }

        // Dosya Seçimi
        dropZone.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles, false);

        // Resmi Kaldır
        removeImageBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Dropzone tetiğini engelle
            resetApp();
        });

        // Filtreleme
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // UI Güncelleme
                filterButtons.forEach(b => {
                    b.classList.remove('bg-black', 'text-white');
                    b.classList.add('text-gray-600', 'hover:bg-gray-100');
                });
                btn.classList.remove('text-gray-600', 'hover:bg-gray-100');
                btn.classList.add('bg-black', 'text-white');

                // Grid Filtreleme
                const filterValue = btn.getAttribute('data-filter');
                filterGrid(filterValue);
            });
        });

        // ZIP İndir
        downloadAllBtn.addEventListener('click', downloadZip);

        // --- Fonksiyonlar ---

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files: files } });
        }

        function handleFiles(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    sourceImage.src = e.target.result;
                    
                    // Görsel yüklendiğinde işlemleri başlat
                    originalImgObject = new Image();
                    originalImgObject.onload = function() {
                        showPreview();
                        processPresets();
                    }
                    originalImgObject.src = e.target.result;
                }
                reader.readAsDataURL(file);
            } else {
                alert('Lütfen geçerli bir görsel dosyası (JPG, PNG, WEBP) yükleyin.');
            }
        }

        function showPreview() {
            dropContent.classList.add('opacity-0');
            setTimeout(() => {
                dropContent.classList.add('hidden');
                previewContainer.classList.remove('hidden');
                outputSection.classList.remove('hidden');
                outputSection.classList.remove('opacity-0');
                outputSection.classList.add('opacity-100');
            }, 300);
        }

        function resetApp() {
            fileInput.value = '';
            originalImgObject = null;
            generatedBlobs = {};
            
            previewContainer.classList.add('hidden');
            dropContent.classList.remove('hidden');
            dropContent.classList.remove('opacity-0');
            
            outputSection.classList.add('opacity-0');
            outputSection.classList.add('hidden');
            
            // Grid temizle
            gridContainer.innerHTML = '';
        }

        // Ana İşlem Fonksiyonu: Canvas üzerinde resize ve crop
        function processPresets() {
            gridContainer.innerHTML = ''; // Temizle
            generatedBlobs = {}; // Reset

            presets.forEach(preset => {
                // Canvas oluştur
                const canvas = document.createElement('canvas');
                canvas.width = preset.w;
                canvas.height = preset.h;
                const ctx = canvas.getContext('2d');

                // Smart Crop (Object-fit: Cover mantığı)
                const scale = Math.max(canvas.width / originalImgObject.width, canvas.height / originalImgObject.height);
                const x = (canvas.width / 2) - (originalImgObject.width / 2) * scale;
                const y = (canvas.height / 2) - (originalImgObject.height / 2) * scale;
                
                // Yüksek kalite çizim ayarları
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // Çizim
                ctx.drawImage(originalImgObject, x, y, originalImgObject.width * scale, originalImgObject.height * scale);

                // Blob oluştur ve sakla
                canvas.toBlob((blob) => {
                    generatedBlobs[preset.id] = blob;
                    
                    // Önizleme Kartı Oluştur (DOM)
                    const card = createCard(preset, canvas.toDataURL('image/jpeg', 0.9));
                    gridContainer.appendChild(card);
                }, 'image/jpeg', 0.9);
            });
        }

        function createCard(preset, dataUrl) {
            const div = document.createElement('div');
            div.className = `group relative bg-white border border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-all duration-300 preset-card flex flex-col`;
            div.setAttribute('data-group', preset.group);

            // macOS ikonları için özel maskeleme sınıfı ekle
            const imgClass = preset.group === 'macos' 
                ? 'macos-squircle max-w-[85%] max-h-[85%] object-cover' 
                : 'max-w-full max-h-full object-contain shadow-sm rounded-sm';

            div.innerHTML = `
                <div class="absolute top-3 left-3 z-10">
                    <span class="bg-black/70 backdrop-blur-sm text-white text-[10px] uppercase font-bold px-2 py-1 rounded">
                        <i class="fa-brands ${preset.icon} mr-1"></i> ${preset.group}
                    </span>
                </div>
                
                <div class="relative w-full aspect-square bg-gray-50 flex items-center justify-center overflow-hidden p-4 group-hover:bg-gray-100 transition-colors">
                     <img src="${dataUrl}" class="${imgClass} transition-transform duration-500 group-hover:scale-105">
                </div>
                
                <div class="p-4 flex justify-between items-center border-t border-gray-100">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900">${preset.name}</h3>
                        <p class="text-xs text-gray-400 mt-0.5">${preset.w} x ${preset.h}</p>
                    </div>
                    <a href="${dataUrl}" download="${preset.name}.jpg" class="text-gray-400 hover:text-black transition-colors" title="İndir">
                        <i class="fa-solid fa-download text-lg"></i>
                    </a>
                </div>
            `;
            return div;
        }

        function filterGrid(filter) {
            const cards = document.querySelectorAll('.preset-card');
            cards.forEach(card => {
                if (filter === 'all' || card.getAttribute('data-group') === filter) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function downloadZip() {
            if (Object.keys(generatedBlobs).length === 0) return;

            const btn = document.getElementById('downloadAllBtn');
            const txt = document.getElementById('downloadText');
            const spinner = document.getElementById('downloadSpinner');
            const icon = btn.querySelector('.fa-file-zipper');

            // Loading state
            txt.innerText = "Hazırlanıyor...";
            icon.classList.add('hidden');
            spinner.classList.remove('hidden');
            btn.disabled = true;

            const zip = new JSZip();
            
            // Klasör yapısı oluştur
            const iosFolder = zip.folder("iOS");
            const macosFolder = zip.folder("macOS"); // Yeni klasör
            const androidFolder = zip.folder("Android");
            const socialFolder = zip.folder("Social_Media");

            presets.forEach(preset => {
                const blob = generatedBlobs[preset.id];
                if (blob) {
                    const fileName = `${preset.name.replace(/\s+/g, '_')}_${preset.w}x${preset.h}.jpg`;
                    
                    if (preset.group === 'ios') {
                        iosFolder.file(fileName, blob);
                    } else if (preset.group === 'macos') {
                        macosFolder.file(fileName, blob);
                    } else if (preset.group === 'android') {
                        androidFolder.file(fileName, blob);
                    } else {
                        socialFolder.file(fileName, blob);
                    }
                }
            });

            try {
                const content = await zip.generateAsync({type:"blob"});
                saveAs(content, "Sayz_Assets.zip");
            } catch (err) {
                alert("Zip oluşturulurken bir hata oluştu: " + err);
            } finally {
                // Reset state
                setTimeout(() => {
                    txt.innerText = "Hepsini İndir (ZIP)";
                    icon.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    btn.disabled = false;
                }, 1000);
            }
        }
    </script>
</body>
</html>